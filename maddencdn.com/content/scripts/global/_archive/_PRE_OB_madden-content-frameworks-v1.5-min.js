/**
 * v1.5 - Copyright 2016 Madden Media - All rights reserved.
 *
 * Global frameworks functions for all content.
 */

var _stickyTopBarHeight=0,_stickyTopBarOffset=0,_chapterTops=new Array,_onChapter=0,_setChapterLinkCallback,_chapterSetCompleteCallback,_stickyTopBarEl="#topBar",_stickyTopBarProgressBarEl,_mobileMenuEl="#mobileMenu",_socialMenuTriggerEl="#socialLinksTrigger",_topAndMobileMenuControl="#controlsTrigger",_chapterEl=".chapter",_chapterLinkEl=".chapterLink",_chapterElPrefix="#c",_multiSizeImageEl=".multiSize",_readMoreEl=void 0,_relatedLinkEl="#alsoLikeLinkWrap",DEFAULT_MOBILE_TEST_EL="#isMobile",DEFAULT_TABLET_TEST_EL="#isTablet",DEFAULT_PARALLAX_TEST_EL="#doParallax",IS_RESPONSIVE=document.addEventListener,_isMobile=!1,_isTablet=!1,_doParallax=!1;frameworksOnReady=function(a,b,c){initViewTypes(),initLayout(a,b,c)},frameworksOnScroll=function(){adjustScrollProgress()},frameworksOnTouchMove=function(){adjustScrollProgress()},frameworksOnResize=function(){initViewTypes(),adjustLayoutAfterResize()},initViewTypes=function(){_isMobile=0!=$(DEFAULT_MOBILE_TEST_EL).length&&"none"!=$(DEFAULT_MOBILE_TEST_EL).css("float"),_isTablet=0!=$(DEFAULT_TABLET_TEST_EL).length&&"none"!=$(DEFAULT_TABLET_TEST_EL).css("float"),_doParallax=0!=$(DEFAULT_PARALLAX_TEST_EL).length&&"none"!=$(DEFAULT_PARALLAX_TEST_EL).css("float")},initLayout=function(a,b,c){if(void 0!=a&&(_setChapterLinkCallback=a.setChapterLinkCallback||_setChapterLinkCallback,_chapterSetCompleteCallback=a.chapterSetCompleteCallback||_chapterSetCompleteCallback),void 0!=b&&(_stickyTopBarEl=b.topBar||_stickyTopBarEl,_mobileMenuEl=b.mobileMenuEl||_mobileMenuEl,_socialMenuTriggerEl=b.socialMenuTriggerEl||_socialMenuTriggerEl,_topAndMobileMenuControl=b.topAndMobileMenuControl||_topAndMobileMenuControl,_chapterEl=b.chapterEl||_chapterEl,_chapterLinkEl=b.chapterLinkEl||_chapterLinkEl,_chapterElPrefix=b.chapterElPrefix||_chapterElPrefix,_multiSizeImageEl=b.multiSizeImageEl||_multiSizeImageEl,_readMoreEl=b.readMoreEl||_readMoreEl,_relatedLinkEl=b.relatedLinkEl||_relatedLinkEl),$(_mobileMenuEl).length){var d=$(_mobileMenuEl),e=d.data("chapters"),f=d.data("top-link"),g=d.data("close-trigger");try{$(g).click(function(){toggleMobileMenu(_mobileMenuEl,_topAndMobileMenuControl)}),$(f).click(function(){toTop(),toggleMobileMenu(_mobileMenuEl,_topAndMobileMenuControl)}),$(e).children("div").each(function(a){$(this).click(function(){toggleMobileMenu(_mobileMenuEl,_topAndMobileMenuControl);var b=$(this).data("chapter");"undefined"==typeof b?goToChapter(a+1):goToChapter(parseInt(b))})})}catch(a){console.log(a)}}if($(_socialMenuTriggerEl).length){var h=$(_socialMenuTriggerEl),i=h.data("social-links"),j=h.data("social-links-class-off"),k=h.data("social-links-class-on"),l=h.data("trigger-class-off"),m=h.data("trigger-class-on");try{var n=$(i);getIsDesktop()?n.on("mouseenter",function(a){h.attr("class",m)}).on("mouseleave",function(a){h.attr("class",l)}):$(document).on("touchstart",i,function(a){n.attr("class",k),h.attr("class",m)}).on("touchend",function(){n.attr("class",j),h.attr("class",l)}).on("touchcancel",function(){n.attr("class",j),h.attr("class",l)})}catch(a){console.log(a)}}$(".socialShare").each(function(){var a=$(this).attr("class"),b="#",c=!1;if(a.indexOf("pinterest")!=-1){var d=$(this).data("ogimage");b=buildSocialShareLink("PINTEREST",d)}else a.indexOf("twitter")!=-1?b=buildSocialShareLink("TWITTER",null):a.indexOf("facebook")!=-1&&(c=!0,b=buildSocialShareLink("FACEBOOK",null));null==b?$(this).attr("href","javascript:alert('Sharing this site is not currently available.')"):c?($(this).attr("href","#"),$(this).attr("onclick",b)):$(this).attr("href",b)}),$(_stickyTopBarEl).length&&(_stickyTopBarHeight=$(_stickyTopBarEl).height(),void 0!=$(_stickyTopBarEl).data("offset-el")&&0!=$($(_stickyTopBarEl).data("offset-el")).length&&(_stickyTopBarOffset=$($(_stickyTopBarEl).data("offset-el")).offset().top),void 0!=$(_stickyTopBarEl).data("progress-bar-el")&&0!=$($(_stickyTopBarEl).data("progress-bar-el")).length&&(_stickyTopBarProgressBarEl=$(_stickyTopBarEl).data("progress-bar-el"))),void 0!=_readMoreEl&&($.isArray(_readMoreEl)||(_readMoreEl=[_readMoreEl]),$.each(_readMoreEl,function(a,b){$(b).click(function(){var a=0;void 0!=$(b).data("offset-el")&&0!=$($(b).data("offset-el")).length&&(a=$($(b).data("offset-el")).offset().top),$("html, body").animate({scrollTop:a-_stickyTopBarHeight},300)})})),adjustMultiSizedImages(),c&&initChapterTops(!0),$(_chapterLinkEl).click(function(){var a=$(this).data("chapter");if("undefined"!=typeof a)goToChapter(parseInt(a));else{$(this.hash);goToChapter(this.hash.substr(1))}return!1})},initChapterTops=function(a){var b=new Array;$(_chapterEl).each(function(a){b[a]=Math.floor($(this).offset().top-_stickyTopBarHeight)}),_chapterTops=b,a&&adjustScrollProgress()},buildSocialShareLink=function(a,b){var c="",d="",e="",f=encodeURIComponent(document.title),g=encodeURIComponent(b);if("file:"==location.protocol){var h=$("body").data("online-url"),i=$("link[rel='canonical']").href;if("undefined"!=typeof h?d=h:"undefined"!=typeof i&&(d=i),""==d)return null}else""==d&&(d=[location.protocol,"//",location.host,location.pathname].join(""));switch(e=encodeURIComponent(d),a){case"FACEBOOK":c="window.open('https://www.facebook.com/sharer/sharer.php?u="+e+"','facebook-share-dialog', 'width=626,height=436'); return false;";break;case"PINTEREST":c="https://www.pinterest.com/pin/create/button/?description="+f+"&amp;url="+e+"&amp;media="+g;break;case"TWITTER":c="https://twitter.com/intent/tweet?text="+f+"%3A%20"+e+"&amp;source=webclient"}return c},buildRelatedLinks=function(a){for(var b=$(_relatedLinkEl),c=0;c<a.length;c++){var d=c+1,e="<div class='linkWrapper'><a href='"+a[c].link+"' target='_blank'><div class='rLink rLink"+d+"'><div id='linkWrapper"+d+"' class='linkTitleWrapper'><div class='linkTitle'>"+a[c].title+"</div></div></div></a></div>";b.append(e)}},getCurrentChapter=function(){return _onChapter},getVisibleViewport=function(a){return a?window.innerHeight-_stickyTopBarHeight+"px":parseInt(window.innerHeight-_stickyTopBarHeight)},getViewportOffset=function(a,b){return b?$(a).offset().top-$(window).scrollTop()-_stickyTopBarHeight+"px":parseInt($(a).offset().top-$(window).scrollTop()-_stickyTopBarHeight)},getItemInViewport=function(a){var b=$(a).offset().top;return!(b+$(a).outerHeight()<=$(window).scrollTop()||b>=$(window).scrollTop()+$(window).height())},getItemInViewportCenter=function(a,b){var c=$(a).offset().top,d=$(window).height()/2;return b=b||0,!(c>=$(window).scrollTop()+d+b||c<=$(window).scrollTop()+d-b)},getStickyTopBarHeight=function(){return _stickyTopBarHeight},getIsMobile=function(){return _isMobile},getIsTablet=function(){return _isTablet},getDoParallax=function(){return _doParallax},getIsDesktop=function(){return!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},getIsIPad=function(){return navigator.userAgent.match(/iPad;.*CPU.*OS/i)},getIsIPad=function(){return navigator.userAgent.match(/iPad;.*CPU.*OS/i)},getIsNewerIpad=function(){return!!getIsIPad()&&1!=window.devicePixelRatio},getIsResponsive=function(){return IS_RESPONSIVE},adjustLayoutAfterResize=function(){initChapterTops(!0),adjustMultiSizedImages()},adjustChapterLinksArtHeight=function(a,b){$(a).css("height",$(b).outerHeight())},adjustSizeToParentAndViewport=function(a,b){$(a).css("height",getVisibleViewport(!0)),$(a).css("width",$(b).width())},adjustSizeHeightToParent=function(a,b){var c=$(b).height();$(a).css("height",c+"px")},equalizeElementHeightsToTallest=function(a){for(var b=0,c=0;c<a.length;c++){var d=$(a[c]).height();null!=d&&(b=d>b?d:b)}for(var c=0;c<a.length;c++)$(a[c]).css("height",b+"px")},adjustScrollProgress=function(){if(0!=$(_stickyTopBarProgressBarEl).length){var e,a=-1,b=$(document).height(),c=$("body").height(),d=b-c-_stickyTopBarOffset;e=Math.round(($(document).scrollTop()-_stickyTopBarOffset)/d*100),$(_stickyTopBarProgressBarEl).css("width",e+"%");for(var f=_chapterTops.length-1;f>=0;f--)if($(document).scrollTop()>=_chapterTops[f]){a=f+1;break}return a!=-1&&adjustChapterLinks(a),a}},adjustChapterLinks=function(a){$(_chapterLinkEl).each(function(){$(this).attr("href")!="#"+a?"function"==typeof _setChapterLinkCallback&&_setChapterLinkCallback(this,!1):("function"==typeof _setChapterLinkCallback&&_setChapterLinkCallback(this,!0),_onChapter=a)})},adjustMultiSizedImages=function(){var a=$(_multiSizeImageEl);a.length&&a.each(function(){getIsResponsive()||void 0==$(this).data("src-legacy")?getIsMobile()&&void 0!=$(this).data("src-small")?$(this).attr("src",$(this).data("src-small")):getIsTablet()&&void 0!=$(this).data("src-medium")?$(this).attr("src",$(this).data("src-medium")):void 0!=$(this).data("src")&&$(this).attr("src",$(this).data("src")):$(this).attr("src",$(this).data("src-legacy"))})},toTop=function(){$("html, body").animate({scrollTop:0},600)},runTopMenuControl=function(){getIsMobile()?toggleMobileMenu(_mobileMenuEl,_topAndMobileMenuControl):toTop()},toggleMobileMenu=function(a,b){getIsMobile()&&($(a).toggle("fast"),$(b).toggle("fast"))},goToChapter=function(a){var b=$(_chapterElPrefix+a),c=b.offset().top-_stickyTopBarHeight+1,d=_onChapter>a?_onChapter-a:a-_onChapter,e=Math.floor(1e3/(_chapterTops.length-(_chapterTops.length-d)));$("html, body").animate({scrollTop:c},e,function(){adjustChapterLinks(a),"function"==typeof _chapterSetCompleteCallback&&_chapterSetCompleteCallback(a)}),_onChapter=a},animateOverflowContent=function(a,b,c,d,e){if(e==_onChapter){var f=$(a).css("background-position").split(" "),g=isNaN(b)?b:b+parseInt(f[0])+"px",h=isNaN(c)?c:c+parseInt(f[1])+"px";$(a).css({"background-position":g+" "+h})}window.setTimeout(function(){animateOverflowContent(a,b,c,d,e)},d)},cycleImages=function(a,b){var c=$(a+" .active"),d=c.next().length>0?c.next():$(a+" img:first");d.css("z-index",2),c.fadeOut(b,function(){c.css("z-index",1).show().removeClass("active"),d.css("z-index",3).addClass("active")})};