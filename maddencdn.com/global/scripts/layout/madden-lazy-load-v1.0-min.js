/**
 * v1.0 - Copyright 2018 Madden Media - All rights reserved.
 *
 * Supports lazy loading of page content based on usage of data attributes. The current
 *	document size used to evaluate which size to load uses the standard Madden Media
 *	floating div test.
 */
(function(root,factory){if(typeof define==='function'&&define.amd){define([],factory(root))}else if(typeof exports==='object'){module.exports=factory(root)}else{root.MMLazyLoad=factory(root)}})(typeof global!=="undefined"?global:this.window||this.global,function(root){'use strict';var IS_BOT=/bot|google|baidu|bing|msn|duckduckgo|teoma|slurp|yandex/i.test(navigator.userAgent);var smTestEl=null;var mdTestEl=null;var lgTestEl=null;var _isSmall=false;var _isMedium=false;var _isLarge=false;var MMLazyLoad={};var supports=((!!document.querySelector)&&(!!root.addEventListener));var settings={};var defaults={loadElements:null,preloadDistanceLg:1000,preloadDistanceMd:600,preloadDistanceSm:250,debug:false};var windowHeight=Math.max(document.documentElement.clientHeight,window.innerHeight||0);var scrollTop=window.pageYOffset;var MMLazyLoadEls=[];var MMProcessedlazyLoadEls=[];MMLazyLoad.init=function(options){if(!supports){return}MMLazyLoad.destroy();settings=options;for(var opt in defaults){if(typeof settings[opt]==='undefined'){settings[opt]=defaults[opt]}}smTestEl=document.getElementById("isSmall");mdTestEl=document.getElementById("isMedium");lgTestEl=document.getElementById("isLarge");if(settings.loadElements==null){console.log("LAZYLOAD: No elements provided - please do so during config with 'loadElements'. Exiting now.");return}if((!smTestEl)||(!mdTestEl)||(!lgTestEl)){console.log("LAZYLOAD: Missing one or more size testers. Exiting now.");return}getDocumentSize();for(var i=0;i<settings.loadElements.length;i+=1){if((IS_BOT)||(settings.loadElements[i].getAttribute("data-load-onload"))){loadContent(settings.loadElements[i],settings.debug)}else{MMLazyLoadEls.push(settings.loadElements[i])}}window.addEventListener("resize",windowResizeListener,false);window.addEventListener("orientationchange",windowResizeListener,false);window.addEventListener("scroll",windowScrollListener,false);return MMLazyLoad};MMLazyLoad.destroy=function(){if(!settings){return}window.removeEventListener("resize",windowResizeListener,false);window.removeEventListener("orientationchange",windowResizeListener,false);window.removeEventListener("scroll",windowScrollListener,false);settings=null};MMLazyLoad.getDebugMode=function(){if(!settings){return}return settings.debug};MMLazyLoad.setDebugMode=function(debug){if(!settings){return}settings.debug=debug};function windowResizeListener(e){getDocumentSize();windowHeight=Math.max(document.documentElement.clientHeight,window.innerHeight||0);scrollTop=window.pageYOffset;for(var i=0;i<MMProcessedlazyLoadEls.length;i+=1){loadContent(MMProcessedlazyLoadEls[i],settings.debug)}}function windowScrollListener(e){scrollTop=(window.pageYOffset+windowHeight);for(var i=0;i<MMLazyLoadEls.length;i+=1){var elOffsetTop=Math.max(MMLazyLoadEls[i].getBoundingClientRect().top+window.pageYOffset);var size=(MMLazyLoadEls[i].getAttribute("data-load-offset"))?MMLazyLoadEls[i].getAttribute("data-load-offset"):"sm";var offset=0;switch(size){case "lg":offset=settings.preloadDistanceLg;break;case "md":offset=settings.preloadDistanceMd;break;case "sm":offset=settings.preloadDistanceSm;break}if(scrollTop>=(elOffsetTop-offset)){loadContent(MMLazyLoadEls[i],settings.debug);MMProcessedlazyLoadEls.push(MMLazyLoadEls[i]);MMLazyLoadEls.splice(i,1)}}}function getDocumentSize(){var sSm=(window.getComputedStyle)?getComputedStyle(smTestEl,null):smTestEl.currentStyle;var sMd=(window.getComputedStyle)?getComputedStyle(mdTestEl,null):mdTestEl.currentStyle;var sLg=(window.getComputedStyle)?getComputedStyle(lgTestEl,null):lgTestEl.currentStyle;_isSmall=((smTestEl)&&(sSm.getPropertyValue("float")!="none"))?true:false;_isMedium=((mdTestEl)&&(sMd.getPropertyValue("float")!="none"))?true:false;_isLarge=((lgTestEl)&&(sLg.getPropertyValue("float")!="none"))?true:false}function loadContent(el,debug){var sizeData=false;if(el.getAttribute("data-load-all")){sizeData=el.getAttribute("data-load-all")}else if(_isSmall){sizeData=el.getAttribute("data-load-sm")}else if(_isMedium){sizeData=el.getAttribute("data-load-md")}else{sizeData=el.getAttribute("data-load-lg")}if(sizeData){if(el.getAttribute("data-load-type")=="img"){el.setAttribute("src",sizeData);if(el.getAttribute("data-load-alt")){el.setAttribute("alt",el.getAttribute("data-load-alt"))}if(debug){console.log("LAZYLOAD img: "+sizeData)}}else if((el.getAttribute("data-load-type")=="class")&&(!el.classList.contains(sizeData))){el.classList.add(sizeData);if(debug){console.log("LAZYLOAD class: "+sizeData)}}else if(el.getAttribute("data-load-type")=="poster"){el.setAttribute("poster",sizeData);if(debug){console.log("LAZYLOAD poster: "+sizeData)}}}else{if(debug){console.log("LAZYLOAD not loading: no size found for this view");console.log(el)}}}return MMLazyLoad});